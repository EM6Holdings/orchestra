!function(){"use strict";var n=angular.module("orchestra.project_management.services");n.factory("assignmentsVis",["dataService","orchestraApi","iterationsVis","visUtils",function(n,e,s,t){var a,r;return{addingAssignment:!1,setup:function(n){a=n,r=this},draw:function(){var e=t.parentContainer.selectAll(".task"),a=e.selectAll(".assignment").data(function(e){var s=n.taskFromKey(e).assignments.map(function(e){return n.keyFromAssignment(e)});return s.push(),s});a.exit().remove();var r=a.enter().append("g").attr("class","assignment");s.draw(),r.append("circle").attr({"class":"active-assignment",cx:0,cy:15,r:5}),a.selectAll(".active-assignment").attr({fill:function(e){var s=n.assignmentFromKey(e);return"Submitted"==s.status?"rgb(0, 121, 191)":"white"},stroke:function(e){var s=n.assignmentFromKey(e);return"Submitted"==s.status?"white":"rgb(0, 121, 191)"}}),this.drawAssignmentTools()},drawAssignmentTools:function(){var e=this,s=t.parentContainer.selectAll(".task-view").selectAll(".assignment-meta").data(function(e){return n.taskFromKey(e).assignments.map(function(e){return n.keyFromAssignment(e)})});s.exit().remove();var a=s.enter().append("div").attr("class","assignment-meta");a.append("input").attr({"class":"worker-name readonly"}).on("click",function(){d3.select(this).classed("readonly",!1)}).on("blur",function(e){var s=n.assignmentFromKey(e);this.value=s.task.is_human?s.worker.username:"Machine",d3.select(this).classed("readonly",!0)}),s.selectAll(".worker-name").attr({placeholder:function(e){var s=n.assignmentFromKey(e);return s.worker.username||!s.task.is_human?"":"Add new assignment"}}).on("keydown",function(s){var t=n.assignmentFromKey(s);13==d3.event.keyCode&&t.task.is_human&&(t.worker.username?e.reassignAssignment(t,d3.select(this)):e.assign_task(t.task,d3.select(this)))}).each(function(e){var s=n.assignmentFromKey(e);this.value=s.task.is_human?s.worker.username:"Machine"})},assign_task:function(s,t){var a=this;a.addingAssignment||(a.addingAssignment=!0,e.assignTask(s,t.node().value).then(function(){t.node().blur(),n.updateData()},function(n){t.node().value="",t.node().blur();var e="Error assigning task.";400===n.status&&(e=n.data.message),alert(e)})["finally"](function(){a.addingAssignment=!1}))},reassignAssignment:function(n,s){n.reassigning||(n.reassigning=!0,e.reassignAssignment(n,s.node().value).then(function(){n.worker.username=s.node().value,r.draw()},function(n){s.node().blur();var e="Error reassigning worker.";400===n.status&&(e=n.data.message),alert(e)})["finally"](function(){s.node().blur(),s.node().value=n.worker.username,n.reassigning=!1}))}}}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9yY2hlc3RyYS9wcm9qZWN0X21hbmFnZW1lbnQvanMvYXNzaWdubWVudHNWaXMuanMiXSwibmFtZXMiOlsic2VydmljZU1vZHVsZSIsImFuZ3VsYXIiLCJtb2R1bGUiLCJmYWN0b3J5IiwiZGF0YVNlcnZpY2UiLCJvcmNoZXN0cmFBcGkiLCJpdGVyYXRpb25zVmlzIiwidmlzVXRpbHMiLCJfdmlzIiwiYXNzaWdubWVudHNWaXMiLCJhZGRpbmdBc3NpZ25tZW50Iiwic2V0dXAiLCJ2aXMiLCJ0aGlzIiwiZHJhdyIsInRhc2tzIiwicGFyZW50Q29udGFpbmVyIiwic2VsZWN0QWxsIiwiYXNzaWdubWVudHMiLCJkYXRhIiwidGFza0tleSIsInRhc2tGcm9tS2V5IiwibWFwIiwiYXNzaWdubWVudCIsImtleUZyb21Bc3NpZ25tZW50IiwicHVzaCIsImV4aXQiLCJyZW1vdmUiLCJhc3NpZ25tZW50c0VudGVyIiwiZW50ZXIiLCJhcHBlbmQiLCJhdHRyIiwiY2xhc3MiLCJjeCIsImN5IiwiciIsImZpbGwiLCJhc3NpZ25tZW50S2V5IiwiYXNzaWdubWVudEZyb21LZXkiLCJzdGF0dXMiLCJzdHJva2UiLCJkcmF3QXNzaWdubWVudFRvb2xzIiwiYXNzaWdubWVudHNNZXRhIiwiYXNzaWdubWVudHNNZXRhRW50ZXIiLCJvbiIsImQzIiwic2VsZWN0IiwiY2xhc3NlZCIsInZhbHVlIiwidGFzayIsImlzX2h1bWFuIiwid29ya2VyIiwidXNlcm5hbWUiLCJwbGFjZWhvbGRlciIsImV2ZW50Iiwia2V5Q29kZSIsInJlYXNzaWduQXNzaWdubWVudCIsImFzc2lnbl90YXNrIiwiZWFjaCIsImlucHV0RWwiLCJhc3NpZ25UYXNrIiwibm9kZSIsInRoZW4iLCJibHVyIiwidXBkYXRlRGF0YSIsInJlc3BvbnNlIiwiZXJyb3JNZXNzYWdlIiwibWVzc2FnZSIsImFsZXJ0IiwicmVhc3NpZ25pbmciXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0UsWUFFQSxJQUFJQSxHQUFnQkMsUUFB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T0FBT2IsT0FDMUNjLEtBQUssV0FDSkgsRUFBUUUsT0FBT0UsT0FDZjNELEVBQVk0RCxjQUNYLFNBQVNDLEdBQ1ZOLEVBQVFFLE9BQU9iLE1BQVEsR0FDdkJXLEVBQVFFLE9BQU9FLE1BQ2YsSUFBSUcsR0FBZSx1QkFDSyxPQUFwQkQsRUFBUzFCLFNBQ1gyQixFQUFlRCxFQUFTOUMsS0FBS2dELFNBRS9CQyxNQUFNRixLQVhWN0QsV0FhVyxXQUNQSSxFQUFlQyxrQkFBbUIsTUFHeEM4QyxtQkFBb0IsU0FBU2pDLEVBQVlvQyxHQUtuQ3BDLEVBQVc4QyxjQUdmOUMsRUFBVzhDLGFBQWMsRUFDekJoRSxFQUFhbUQsbUJBQW1CakMsRUFBWW9DLEVBQVFFLE9BQU9iLE9BQ3hEYyxLQUFLLFdBQ0p2QyxFQUFXNEIsT0FBT0MsU0FBV08sRUFBUUUsT0FBT2IsTUFDNUN2QyxFQUFlSyxRQUNkLFNBQVNtRCxHQUNWTixFQUFRRSxPQUFPRSxNQUNmLElBQUlHLEdBQWUsMkJBQ0ssT0FBcEJELEVBQVMxQixTQUNYMkIsRUFBZUQsRUFBUzlDLEtBQUtnRCxTQUUvQkMsTUFBTUYsS0FWVjdELFdBWVcsV0FDUHNELEVBQVFFLE9BQU9FLE9BQ2ZKLEVBQVFFLE9BQU9iLE1BQVF6QixFQUFXNEIsT0FBT0MsU0FDekM3QixFQUFXOEMsYUFBYyIsImZpbGUiOiJvcmNoZXN0cmEvcHJvamVjdF9tYW5hZ2VtZW50L2pzL2Fzc2lnbm1lbnRzVmlzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBzZXJ2aWNlTW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ29yY2hlc3RyYS5wcm9qZWN0X21hbmFnZW1lbnQuc2VydmljZXMnKTtcblxuICBzZXJ2aWNlTW9kdWxlLmZhY3RvcnkoJ2Fzc2lnbm1lbnRzVmlzJywgZnVuY3Rpb24oZGF0YVNlcnZpY2UsIG9yY2hlc3RyYUFwaSwgaXRlcmF0aW9uc1ZpcywgdmlzVXRpbHMpIHtcbiAgICAvKipcbiAgICAgKiBTZXJ2aWNlIHRvIG1vZHVsYXJpemUgYXNzaWdubWVudCB2aXN1YWxpemF0aW9uIGFuZCBtYW5pcHVsYXRpb24gd2l0aGluXG4gICAgICogdGhlIHByb2plY3QgbWFuYWdlbWVudCB2aWV3LlxuICAgICAqL1xuICAgIHZhciBfdmlzO1xuICAgIHZhciBhc3NpZ25tZW50c1ZpcztcblxuICAgIHJldHVybiB7XG4gICAgICBhZGRpbmdBc3NpZ25tZW50OiBmYWxzZSxcbiAgICAgIHNldHVwOiBmdW5jdGlvbih2aXMpIHtcbiAgICAgICAgX3ZpcyA9IHZpcztcbiAgICAgICAgYXNzaWdubWVudHNWaXMgPSB0aGlzO1xuICAgICAgfSxcbiAgICAgIGRyYXc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogRHJhd3MvdXBkYXRlcyBhc3NpZ25tZW50cyB3aXRoaW4gcHJvamVjdCBtYW5hZ2VtZW50IHZpc3VhbGl6YXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgdGFza3MgPSB2aXNVdGlscy5wYXJlbnRDb250YWluZXIuc2VsZWN0QWxsKCcudGFzaycpO1xuXG4gICAgICAgIHZhciBhc3NpZ25tZW50cyA9IHRhc2tzLnNlbGVjdEFsbCgnLmFzc2lnbm1lbnQnKVxuICAgICAgICAgIC5kYXRhKGZ1bmN0aW9uKHRhc2tLZXkpIHtcbiAgICAgICAgICAgIHZhciBhc3NpZ25tZW50cyA9IGRhdGFTZXJ2aWNlLnRhc2tGcm9tS2V5KHRhc2tLZXkpLmFzc2lnbm1lbnRzLm1hcChmdW5jdGlvbihhc3NpZ25tZW50KSB7XG4gICAgICAgICAgICAgIHJldHVybiBkYXRhU2VydmljZS5rZXlGcm9tQXNzaWdubWVudChhc3NpZ25tZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYXNzaWdubWVudHMucHVzaCgpO1xuICAgICAgICAgICAgcmV0dXJuIGFzc2lnbm1lbnRzO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGFzc2lnbm1lbnRzLmV4aXQoKS5yZW1vdmUoKTtcbiAgICAgICAgdmFyIGFzc2lnbm1lbnRzRW50ZXIgPSBhc3NpZ25tZW50cy5lbnRlcigpLmFwcGVuZCgnZycpXG4gICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2Fzc2lnbm1lbnQnKTtcblxuICAgICAgICBpdGVyYXRpb25zVmlzLmRyYXcoKTtcblxuICAgICAgICBhc3NpZ25tZW50c0VudGVyLmFwcGVuZCgnY2lyY2xlJylcbiAgICAgICAgICAuYXR0cih7XG4gICAgICAgICAgICAnY2xhc3MnOiAnYWN0aXZlLWFzc2lnbm1lbnQnLFxuICAgICAgICAgICAgJ2N4JzogMCxcbiAgICAgICAgICAgICdjeSc6IDE1LFxuICAgICAgICAgICAgJ3InOiA1LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGFzc2lnbm1lbnRzLnNlbGVjdEFsbCgnLmFjdGl2ZS1hc3NpZ25tZW50JykuYXR0cih7XG4gICAgICAgICAgJ2ZpbGwnOiBmdW5jdGlvbihhc3NpZ25tZW50S2V5KSB7XG4gICAgICAgICAgICB2YXIgYXNzaWdubWVudCA9IGRhdGFTZXJ2aWNlLmFzc2lnbm1lbnRGcm9tS2V5KGFzc2lnbm1lbnRLZXkpO1xuICAgICAgICAgICAgcmV0dXJuIGFzc2lnbm1lbnQuc3RhdHVzID09ICdTdWJtaXR0ZWQnID8gJ3JnYigwLCAxMjEsIDE5MSknIDogJ3doaXRlJztcbiAgICAgICAgICB9LFxuICAgICAgICAgICdzdHJva2UnOiBmdW5jdGlvbihhc3NpZ25tZW50S2V5KSB7XG4gICAgICAgICAgICB2YXIgYXNzaWdubWVudCA9IGRhdGFTZXJ2aWNlLmFzc2lnbm1lbnRGcm9tS2V5KGFzc2lnbm1lbnRLZXkpO1xuICAgICAgICAgICAgcmV0dXJuIGFzc2lnbm1lbnQuc3RhdHVzID09ICdTdWJtaXR0ZWQnID8gJ3doaXRlJyA6ICdyZ2IoMCwgMTIxLCAxOTEpJztcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuZHJhd0Fzc2lnbm1lbnRUb29scygpO1xuICAgICAgfSxcbiAgICAgIGRyYXdBc3NpZ25tZW50VG9vbHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogRHJhd3MgYWJzb2x1dGUtcG9zaXRpbmVkIEhUTUwgZWxlbWVudHMgdG8gYWxsb3cgZm9yIGFzc2lnbm1lbnRcbiAgICAgICAgICogbWFuaXB1bGF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGFzc2lnbm1lbnRzVmlzID0gdGhpcztcbiAgICAgICAgdmFyIGFzc2lnbm1lbnRzTWV0YSA9IHZpc1V0aWxzLnBhcmVudENvbnRhaW5lclxuICAgICAgICAgIC5zZWxlY3RBbGwoJy50YXNrLXZpZXcnKVxuICAgICAgICAgIC5zZWxlY3RBbGwoJy5hc3NpZ25tZW50LW1ldGEnKVxuICAgICAgICAgIC5kYXRhKGZ1bmN0aW9uKHRhc2tLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRhU2VydmljZS50YXNrRnJvbUtleSh0YXNrS2V5KS5hc3NpZ25tZW50c1xuICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uKGFzc2lnbm1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVNlcnZpY2Uua2V5RnJvbUFzc2lnbm1lbnQoYXNzaWdubWVudCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGFzc2lnbm1lbnRzTWV0YS5leGl0KCkucmVtb3ZlKCk7XG4gICAgICAgIHZhciBhc3NpZ25tZW50c01ldGFFbnRlciA9IGFzc2lnbm1lbnRzTWV0YS5lbnRlcigpXG4gICAgICAgICAgLmFwcGVuZCgnZGl2JylcbiAgICAgICAgICAuYXR0cignY2xhc3MnLCAnYXNzaWdubWVudC1tZXRhJyk7XG5cbiAgICAgICAgYXNzaWdubWVudHNNZXRhRW50ZXIuYXBwZW5kKCdpbnB1dCcpXG4gICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgJ2NsYXNzJzogJ3dvcmtlci1uYW1lIHJlYWRvbmx5JyxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5jbGFzc2VkKCdyZWFkb25seScsIGZhbHNlKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5vbignYmx1cicsIGZ1bmN0aW9uKGFzc2lnbm1lbnRLZXkpIHtcbiAgICAgICAgICAgIHZhciBhc3NpZ25tZW50ID0gZGF0YVNlcnZpY2UuYXNzaWdubWVudEZyb21LZXkoYXNzaWdubWVudEtleSk7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gYXNzaWdubWVudC50YXNrLmlzX2h1bWFuID8gYXNzaWdubWVudC53b3JrZXIudXNlcm5hbWUgOiAnTWFjaGluZSc7XG4gICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuY2xhc3NlZCgncmVhZG9ubHknLCB0cnVlKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICBhc3NpZ25tZW50c01ldGEuc2VsZWN0QWxsKCcud29ya2VyLW5hbWUnKVxuICAgICAgICAgIC5hdHRyKHtcbiAgICAgICAgICAgICdwbGFjZWhvbGRlcic6IGZ1bmN0aW9uKGFzc2lnbm1lbnRLZXkpIHtcbiAgICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSBkYXRhU2VydmljZS5hc3NpZ25tZW50RnJvbUtleShhc3NpZ25tZW50S2V5KTtcbiAgICAgICAgICAgICAgcmV0dXJuIGFzc2lnbm1lbnQud29ya2VyLnVzZXJuYW1lIHx8ICFhc3NpZ25tZW50LnRhc2suaXNfaHVtYW4gPyAnJyA6ICdBZGQgbmV3IGFzc2lnbm1lbnQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgICAgLm9uKCdrZXlkb3duJywgZnVuY3Rpb24oYXNzaWdubWVudEtleSkge1xuICAgICAgICAgICAgdmFyIGFzc2lnbm1lbnQgPSBkYXRhU2VydmljZS5hc3NpZ25tZW50RnJvbUtleShhc3NpZ25tZW50S2V5KTtcbiAgICAgICAgICAgIGlmIChkMy5ldmVudC5rZXlDb2RlID09IDEzICYmIGFzc2lnbm1lbnQudGFzay5pc19odW1hbikge1xuICAgICAgICAgICAgICBpZiAoIWFzc2lnbm1lbnQud29ya2VyLnVzZXJuYW1lKSB7XG4gICAgICAgICAgICAgICAgYXNzaWdubWVudHNWaXMuYXNzaWduX3Rhc2soYXNzaWdubWVudC50YXNrLCBkMy5zZWxlY3QodGhpcykpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFzc2lnbm1lbnRzVmlzLnJlYXNzaWduQXNzaWdubWVudChhc3NpZ25tZW50LCBkMy5zZWxlY3QodGhpcykpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZWFjaChmdW5jdGlvbihhc3NpZ25tZW50S2V5KSB7XG4gICAgICAgICAgICB2YXIgYXNzaWdubWVudCA9IGRhdGFTZXJ2aWNlLmFzc2lnbm1lbnRGcm9tS2V5KGFzc2lnbm1lbnRLZXkpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZSA9IGFzc2lnbm1lbnQudGFzay5pc19odW1hbiA/IGFzc2lnbm1lbnQud29ya2VyLnVzZXJuYW1lIDogJ01hY2hpbmUnO1xuICAgICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGFzc2lnbl90YXNrOiBmdW5jdGlvbih0YXNrLCBpbnB1dEVsKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGVzIHRoZSBwcm9taXNlIHJldHVybmVkIGJ5IG9yY2hlc3RyYUFwaS5hc3NpZ25UYXNrIGluIHRoZVxuICAgICAgICAgKiB2aXN1YWxpemF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGFzc2lnbm1lbnRzVmlzID0gdGhpcztcbiAgICAgICAgaWYgKGFzc2lnbm1lbnRzVmlzLmFkZGluZ0Fzc2lnbm1lbnQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYXNzaWdubWVudHNWaXMuYWRkaW5nQXNzaWdubWVudCA9IHRydWU7XG4gICAgICAgIG9yY2hlc3RyYUFwaS5hc3NpZ25UYXNrKHRhc2ssIGlucHV0RWwubm9kZSgpLnZhbHVlKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaW5wdXRFbC5ub2RlKCkuYmx1cigpO1xuICAgICAgICAgICAgZGF0YVNlcnZpY2UudXBkYXRlRGF0YSgpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpbnB1dEVsLm5vZGUoKS52YWx1ZSA9ICcnO1xuICAgICAgICAgICAgaW5wdXRFbC5ub2RlKCkuYmx1cigpO1xuICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9ICdFcnJvciBhc3NpZ25pbmcgdGFzay4nO1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAwKSB7XG4gICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFsZXJ0KGVycm9yTWVzc2FnZSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZmluYWxseShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFzc2lnbm1lbnRzVmlzLmFkZGluZ0Fzc2lnbm1lbnQgPSBmYWxzZTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICByZWFzc2lnbkFzc2lnbm1lbnQ6IGZ1bmN0aW9uKGFzc2lnbm1lbnQsIGlucHV0RWwpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgdGhlIHByb21pc2UgcmV0dXJuZWQgYnkgb3JjaGVzdHJhQXBpLnJlYXNzaWduQXNzaWdubWVudCBpblxuICAgICAgICAgKiB0aGUgdmlzdWFsaXphdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIGlmIChhc3NpZ25tZW50LnJlYXNzaWduaW5nKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFzc2lnbm1lbnQucmVhc3NpZ25pbmcgPSB0cnVlO1xuICAgICAgICBvcmNoZXN0cmFBcGkucmVhc3NpZ25Bc3NpZ25tZW50KGFzc2lnbm1lbnQsIGlucHV0RWwubm9kZSgpLnZhbHVlKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYXNzaWdubWVudC53b3JrZXIudXNlcm5hbWUgPSBpbnB1dEVsLm5vZGUoKS52YWx1ZTtcbiAgICAgICAgICAgIGFzc2lnbm1lbnRzVmlzLmRyYXcoKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgaW5wdXRFbC5ub2RlKCkuYmx1cigpO1xuICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9ICdFcnJvciByZWFzc2lnbmluZyB3b3JrZXIuJztcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhbGVydChlcnJvck1lc3NhZ2UpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpbnB1dEVsLm5vZGUoKS5ibHVyKCk7XG4gICAgICAgICAgICBpbnB1dEVsLm5vZGUoKS52YWx1ZSA9IGFzc2lnbm1lbnQud29ya2VyLnVzZXJuYW1lO1xuICAgICAgICAgICAgYXNzaWdubWVudC5yZWFzc2lnbmluZyA9IGZhbHNlO1xuICAgICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9O1xuICB9KTtcbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
